name: Auto Rename Files

on:
  push:
    paths:
      - 'input/**'
  workflow_dispatch:

jobs:
  process-files:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
      with:
        fetch-depth: 0
        
    - name: Create folders if they don't exist
      run: |
        # –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫–∏ –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
        mkdir -p input data
        
        # –°–æ–∑–¥–∞–µ–º .gitkeep —Ñ–∞–π–ª—ã –µ—Å–ª–∏ –ø–∞–ø–∫–∏ –ø—É—Å—Ç—ã–µ
        if [ ! -f "input/.gitkeep" ]; then
          echo "Folder for user input files" > input/.gitkeep
        fi
        
        if [ ! -f "data/.gitkeep" ]; then
          echo "Folder for processed graph files" > data/.gitkeep
        fi
        
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: Process and rename files
      run: |
        node << 'EOF'
        const fs = require('fs');
        const path = require('path');
        
        console.log('=== –û–ë–†–ê–ë–û–¢–ö–ê –§–ê–ô–õ–û–í –ò–ó –ü–ê–ü–ö–ò INPUT ===');
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–∞–ø–æ–∫ (–¥–æ–ª–∂–Ω—ã —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —à–∞–≥–∞)
        if (!fs.existsSync('input')) {
          fs.mkdirSync('input', { recursive: true });
        }
        
        if (!fs.existsSync('data')) {
          fs.mkdirSync('data', { recursive: true });
        }
        
        // –ü–æ–ª—É—á–∞–µ–º —Ñ–∞–π–ª—ã –∏–∑ input, –∏–≥–Ω–æ—Ä–∏—Ä—É—è .gitkeep
        const inputFiles = fs.readdirSync('input')
          .filter(f => f !== '.gitkeep' && f !== '.gitignore');
        console.log('üì• –§–∞–π–ª—ã –≤ input:', inputFiles);
        
        // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–∏ ...
        EOF
        
    - name: Commit folder structure and changes
      run: |
        # –î–æ–±–∞–≤–ª—è–µ–º .gitkeep —Ñ–∞–π–ª—ã –µ—Å–ª–∏ –æ–Ω–∏ –±—ã–ª–∏ —Å–æ–∑–¥–∞–Ω—ã
        git add input/.gitkeep data/.gitkeep || true
        
        # –î–æ–±–∞–≤–ª—è–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
        git add .
        
        # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        git config user.name 'github-actions[bot]'
        git config user.email 'github-actions[bot]@users.noreply.github.com'
        
        # –ö–æ–º–º–∏—Ç–∏–º –µ—Å–ª–∏ –µ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
        if git diff --staged --quiet; then
          echo "–ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –∫–æ–º–º–∏—Ç–∞"
        else
          git commit -m "Added"
          echo "–ò–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–∫–æ–º–º–∏—á–µ–Ω—ã"
        fi
