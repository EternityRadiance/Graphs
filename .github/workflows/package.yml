name: Create Graph Archive

on:
  workflow_dispatch:
    inputs:
      graph_names:
        description: 'Graph names'
        required: true
        type: string
      request_id:
        description: 'Request ID'
        required: true
        type: string

jobs:
  create-zip:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Create ZIP
      env:
        GRAPH_NAMES: ${{ github.event.inputs.graph_names }}
        REQUEST_ID: ${{ github.event.inputs.request_id }}
      run: |
        TEMP_DIR="temp_$REQUEST_ID"
        mkdir -p "$TEMP_DIR"
        
        IFS=',' read -ra GRAPHS <<< "$GRAPH_NAMES"
        
        for graph in "${GRAPHS[@]}"; do
          graph_clean=$(echo "$graph" | xargs)
          if [ -n "$graph_clean" ]; then
            URL="https://raw.githubusercontent.com/${{ github.repository }}/main/data/${graph_clean}.json"
            curl -s -f -o "$TEMP_DIR/${graph_clean}.json" "$URL" || true
          fi
        done
        
        zip -r "graphs-$REQUEST_ID.zip" "$TEMP_DIR/"
        rm -rf "$TEMP_DIR"
      
    - name: Upload artifact
      uses: actions/upload-artifact@v4
      with:
        name: graphs-${{ github.event.inputs.request_id }}
        path: graphs-*.zip
        retention-days: 1
